Installing the CSSC zonal deployment
====================================

These are some installation instructions and notes for the CSSC Zonal deployment.  Before attempting this, you should be comfortable with [[Installing a Custom Site from Launchpad]] and
[[IHRIS Regional Rollout]].


Bazaar Branch
^^^^^^^^^^^^^
The customizations for the zonal deployment of iHRIS Manage for the CSSC can be found on launchpad at: 
   https://code.launchpad.net/ihris-manage-cssc



There are three main directories in this branch:


* modules: a collection of modules for the cssc customization. it also includes the standardized data lists modules.
* import_tools:  a collection of utilities to help create the standardized data lists as well as to import data from the HR spreadsheet
* sites:  the sites for the five zonal offices, a site for the central office, and a dummy site used to define the form storage mechanisms


Standardized Lists
^^^^^^^^^^^^^^^^^^
The standardized lists have been made into data modules.  For example, the cadre list/form can be found at:
  `ihris-manage-cssc-data-cadre.xml <http://bazaar.launchpad.net/%7Eihris%2Bcssc/ihris-manage/data-import-4.0/annotate/head%3A/modules/data-cadre/ihris-manage-cssc-data-cadre.xml>`_   



Once these lists have been created in the .csv format, the appropriate .xml configuration file for the data module can be generated by:
  `import_tools/data_module_creator.php <http://bazaar.launchpad.net/%7Eihris%2Bcssc/ihris-manage/data-import-4.0/annotate/head%3A/import_tools/data_module_creator.php>`_ 
For example,
  cd /var/lib/iHRIS/cssc_zonal_deploy/import_tools
  php data_module_creator.php degree
will create the standradized data module for degree at:
  modules/data-degree/ihris-manage-cssc-data-degree.xml

Once you have generated a new list, please commit it to bzr.  For example:
 cd /var/lib/iHRIS/cssc_zonal_deploy
 bzr add
 bzr commit -m "added the degree list"
This will allow you to easily keep all of the sites on multiple computers up-to-date with the standardized lists.


Databases
^^^^^^^^^

It is assumed that database for each of these sites will be:


* manage_cssc_central
* manage_cssc_western
* manage_cssc_eastern
* manage_cssc_southern
* manage_cssc_northern
* manage_cssc_lake

These databases can exist on either one or many computers.

The central site aggregates each of the zonal offices.  The computer that contains the central site will need to have each of the above databases present.  What you will do to aggregate in the central office is to to a database dump (mysqldump) for each of the zonal offices and import this into mysql on the computer which hosts the central site.


Installation
^^^^^^^^^^^^
These are an adaptation of the regular installation instructions. Please refer to those for more information.

On each of the computers on which iHRIS will run, you will need to download the 4.0.2 (or greater) full-release of iHRIS Manage from here:
  https://launchpad.net/ihris-manage
under the downloads.  You will need to extract this under 
  /var/lib/iHRIS/lib/4.0.2
To do so you can try this:
  sudo mkdir -p /var/lib/iHRIS
  sudo chown -R `whoami`:`whoami` /var/lib/iHRIS
  mkdir -p /var/lib/iHRIS/lib/4.0.2
  ln -s /var/lib/iHRIS/lib/4.0.2 /var/lib/iHRIS/lib/4.0
  cd /var/lib/iHRIS/lib/4.0.2
  wget http://launchpad.net/ihris-manage/4.0/4.0.2/+download/ihris-manage-full-4_0_2.tar.bz2
  tar -xjf  /ihris-manage-full-4_0_2.tar.bz2
Now we will need to download the CSSC customizations:
  cd /var/lib/iHRIS
  bzr checkout http://bazaar.launchpad.net/~ihris-manage-cssc cssc_zonal_deploy
  cd cssc_zonal_deploy
  bzr bind  http://bazaar.launchpad.net/~ihris-manage-cssc
  mkdir -p /var/lib/iHRIS/cssc 
  ln -s /var/lib/iHRIS/cssc_zonal_deploy/modules /var/lib/iHRIS/cssc/4.0
  
For each of the **<SITES>** (central,northern,southern,eastern,western,lake) that will exist on the computer you are installing on you will need to do the following:
 sudo ln -s /var/lib/iHRIS/cssc_zonal_deploy/sites/'''<SITE>'''/pages /var/www/manage-'''<SITE>'''

Next you will need to edit the file(s):
 /var/www/manage-'''<SITE>'''/local/config.value.php
to set the user and password for each of the databases.


Now you should be good to go to install the site.


Form Storage
^^^^^^^^^^^^
The [[Form Storage Mechanisms | form storage mechanisms]] for each form needs to be specified for each of the sites. For example you need to specify whether or not they are aggregating at the central or whether they are the magicdata or entry storage mechanisms.  If they are magicdata you need to specify them as either read-only or writable.

Here are the form storage configurations used:


* entry.  data to be edited at the zonal office.  never used at the central office.
* magicdata read-write. non-standardized lists at the zonal office or standardized lists at the central office.
* magicdata read-only.  standardized lists at the zonal office. never used at the central office.
* multiflat.  never used in the zonal office. used to aggregate at the central office those forms which were "magicdata read-write" or "entry" from the zonal office.

The two basic configurations can be found in:
  `sites/FormStorage_central.xml <http://bazaar.launchpad.net/%7Eihris%2Bcssc/ihris-manage/data-import-4.0/annotate/head%3A/sites/FormStorage_central.xml>`_ 
  `sites/FormStorage_zonal.xml <http://bazaar.launchpad.net/%7Eihris%2Bcssc/ihris-manage/data-import-4.0/annotate/head%3A/sites/FormStorage_zonal.xml>`_ 
and are xincluded in the site configuration files:
 sites/'''<SITE>'''/ihris-manage-cssc-'''<SITE>'''.xml
as appropriate.

Notes:


* rather than type these all by hand, I setup a central_dummy site with all the default for storage mechanisms and ran the script:
 sites/central_dummy/pages/generate_form_storage.php


* The naming conventions for the databases above, manage_cssc_'''<SITE>''' is used to define the aggregation components for the zonal offices to the central office using the multiflat storage mechanism.  This is defined in the beginning of *FormStorage_central.xml*  file.


Importing Data
^^^^^^^^^^^^^^
We will do this once the standard data lists mentioned above are defined

